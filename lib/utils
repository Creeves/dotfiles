#!/bin/bash

# The directory in which to store the backups of our files
DOTFILES_BACKUP_DIRECTORY="backups"

backup_prev() {

    # Define our directories to work with
    TIMESTAMP_DIRECTORY="$(date +%Y-%m-%d_%H-%M-%S)"
    BACKUP_DIRECTORY="${1}/${DOTFILES_BACKUP_DIRECTORY}/${TIMESTAMP_DIRECTORY}"

    # If the user is spamming this button more than once per second,
    # we should just bail now.
    if [ -d ${BACKUP_DIRECTORY} ]; then
        exit
    fi

    # Create the timestamped backup directory
    mkdir ${BACKUP_DIRECTORY}

    # Define an array of items to backup

    declare -a items_to_backup=(
        .gitattributes
        .gitconfig
        .gitignore_global
        .fonts
        .curlrc
        .bash_profile
        .bashrc
        .inputrc
        .profile
        .minttyrc
        .vim
        .vimrc
    )

    # Move all the matching items
    for item in "${items_to_backup[@]}"
    do
        mv $HOME/$item ${BACKUP_DIRECTORY}/$item 2> /dev/null
    done;

    # If the directory is empty, we can just delete it because
    # nothing was backed up
    if [ ! "$(ls -A ${BACKUP_DIRECTORY})" ]; then
        rm -rf ${BACKUP_DIRECTORY}
    fi
}

# Force create/replace the symlink.
link() {
    ln -fs "${1}" "${HOME}/${2}"
}

#
link_files() {

    backup_prev $1

    link "${1}/git/gitattributes"     ".gitattributes"
    link "${1}/git/gitconfig"         ".gitconfig"
    link "${1}/git/gitignore_global"  ".gitignore_global"
    link "${1}/shell/fonts"           ".fonts"
    link "${1}/shell/curlrc"          ".curlrc"
    link "${1}/shell/bashrc"          ".bashrc"
    link "${1}/shell/bash_profile"    ".bash_profile"
    link "${1}/shell/inputrc"         ".inputrc"
    link "${1}/shell/profile"         ".profile"
    link "${1}/shell/minttyrc"        ".minttyrc"
    link "${1}/vim"                   ".vim"
    link "${1}/vim/vimrc"             ".vimrc"

}

# vim: set syn=sh :
