" !silent is used to suppress error messages if the config line
" references plugins/colorschemes that might be missing

" Disable vi-compatibility
set nocompatible

" Point to location of pathogen submodule (since it's not in .vim/autoload)
silent! runtime bundle/vim-pathogen/autoload/pathogen.vim

" Call pathogen plugin management
silent! call pathogen#infect()

if has("autocmd")

    " Load files for specific filetypes
    filetype on
    filetype plugin on
    filetype indent on

    " Make sure we set the correct wrapping size for git commits
    autocmd FileType gitcommit set textwidth=72

    " Treat the syntax highlighting for razor files the same as plain html files
    autocmd BufNewFile,BufRead *.cshtml set filetype=html

    " Make sure markdown files are treated correctly
    autocmd BufNewFile,BufRead *.md set filetype=markdown

    " Set up some settings for ruby
    autocmd BufNewFile,BufRead *.rb set filetype=ruby
    autocmd BufNewFile,BufRead Vagrantfile  set filetype=ruby

    " Automatically strip trailing whitespace on file save
    autocmd BufWritePre * :call StripTrailingWhitespace()

    " Languages with specific tabs/space requirements
    autocmd FileType html setlocal list tabstop=4 softtabstop=4 shiftwidth=4 noexpandtab

endif

if has("syntax")

    " Enable syntax highlighting
    syntax on

    " Set 256 color terminal support
    set t_Co=256

endif

if has("cmdline_info")

    " Show the cursor line and column number
    set ruler

    " Show partial commands in status line
    set showcmd

    " Show whether in insert or replace mode
    set noshowmode

endif

if has("statusline")

    " Always show status line
    set laststatus=2

    " Broken down into easily includeable segments
    set statusline=%<%f\

    " Options
    set statusline+=%w%h%m%r

    " Current dir
    set statusline+=\ [%{getcwd()}]

    " Right aligned file nav info
    set statusline+=%=%-14.(%l,%c%V%)\ %p%%

endif

if has("extra_search")

    " Highlight searches [use :noh to clear]
    set hlsearch

    " Highlight dynamically as pattern is typed
    set incsearch

    " Ignore case of searches...
    set ignorecase

    " ...unless has mixed case
    set smartcase

endif

" Set the colorscheme
colorscheme xoria256

" Set a vertical column only on the lines that bleed over
call matchadd('ColorColumn', '\%81v', 100)

" Set to auto read when a file is changed from the outside
set autoread

" Backspace through everything in INSERT mode
set backspace=indent,eol,start

" Optimize for fast terminal connections
set ttyfast

" Use UTF-8 without BOM
set encoding=utf-8 nobomb

" No line wrapping
set nowrap

" Expand tab to spaces
set expandtab

" Define some default tab widths
set tabstop=4
set softtabstop=4
set shiftwidth=4

" Enable line numbers
set number

" Highlight current line
set cursorline

" Start scrolling three lines before the horizontal window border
set scrolloff=3

" Don't reset cursor to start of line when moving around.
set nostartofline

" Removes top toolbar
set guioptions-=T

" Removes right hand scroll bar
set guioptions-=r

" Removes left hand scroll bar
set go-=L

" Sets the lineheight
set linespace=15

" Define our tags file
set tags=tags

" always set autoindenting on
set autoindent

" copy the previous indentation on autoindenting
set copyindent

" timeout stuff
set timeout
set timeoutlen=1000
set ttimeoutlen=100

" don't beep
set visualbell

" don't beep
set noerrorbells

" Save on buffer switch
set autowrite

" Hide 'invisible' characters
set nolist

" Set characters used to indicate 'invisible' characters
set listchars=tab:▸\-
set listchars+=trail:·
set listchars+=nbsp:_
set listchars+=eol:¬

" Centralize backups, swapfiles and undo history
set backupdir=$HOME/.vim/backups
set directory=$HOME/.vim/swaps
if exists("&undodir")
    set undodir=$HOME/.vim/undo
endif
set viminfo+=n$HOME/.vim/.viminfo

" Turn backup off, since most stuff is in git anyway. The above stuff is just
" so we get the folder structure correct so if we ever turn swaps on, they
" don't pollute our local directories
set nobackup
set nowb
set noswapfile

" Easier window navigation
nmap <C-h> <C-w>h
nmap <C-j> <C-w>j
nmap <C-k> <C-w>k
nmap <C-l> <C-w>l

" Load up our other keybinds
source $HOME/.vim/vimrc_abbr
source $HOME/.vim/vimrc_commands
source $HOME/.vim/vimrc_leaders
source $HOME/.vim/vimrc_mappings
source $HOME/.vim/vimrc_bundle

" Load local machine settings if they exist
if filereadable(glob("$HOME/.vimrc.local"))
    source $HOME/.vimrc.local
endif

" Load up any project specific settings
if filereadable(glob("$PWD/.vimrc.local"))
    source $PWD/.vimrc.local
endif
